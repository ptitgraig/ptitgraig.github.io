<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Memento Backbone.js</title>
    <meta name="description" content="I share my knowledge about web development and christian faith.">
    <link rel="stylesheet" href="/css/index.css">
    <link rel="stylesheet" href="/css/prism-base16-monokai.dark.css">
    <link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="Gorille gris">
    <link rel="alternate" href="/feed/feed.json" type="application/json" title="Gorille gris">
  </head>
  <body>
    <header>
      <h1 class="home"><a href="/">Gorille gris</a></h1>
      <ul class="nav">
        <li class="nav-item">
          <a href="/">posts</a>
        </li>
        <li class="nav-item">
          <a href="/about/">à propos</a>
        </li>
      </ul>
    </header>

    <main class="tmpl-post">
      <h1>Memento Backbone.js</h1>

<p>Backbone est un framework javascript MVC qui permet de construire des applications de type Single-Page-Webapp.</p>
<p>En vérité il s’agit plutôt d’un framework MV* car le Controller n’existe pas vraiment dans Backbone.</p>
<p>Faisons un parrallèle entre un MVC classique et un MVC Backbone.</p>
<!-- more -->
<h2 id="models">Models <a class="direct-link" href="#models">#</a></h2>
<ul>
<li>C’est là ou se fait la validation des données.</li>
<li>Sont persistés soit par du localStorage ou bien par synchronisation avec une base de données.</li>
<li>Plusieurs Views peuvent observer des changements sur un Model. Une View, en effet, regarde un Model et peut ainsi savoir quand un   Model a changé et afficher les infos à jour du Model.</li>
<li>Un ensemble de Models est appelé une Collection. Dès qu’un Model dans cette Collection change, la View attachée à ce Model est notifiée.</li>
</ul>
<h2 id="controllers">Controllers <a class="direct-link" href="#controllers">#</a></h2>
<ul>
<li>N’existe pas. La View joue le rôle de Controller.</li>
<li>Gérer les changements effectués dans la vue par l’utilisateur</li>
<li>Mettre à jour le Model quand un utilisateur a terminé ses actions</li>
</ul>
<h2 id="views">Views <a class="direct-link" href="#views">#</a></h2>
<ul>
<li>C’est là que les utilisateurs cliquent et font mumuse.</li>
<li>Donc c’est là qu’on lit / edite / supprime les données d’un Model.</li>
<li>Il y a une fonction <code>render()</code> qui doit s’occuper d’afficher le contenu du Model (ça utilise le moteur de template de Underscore.js). On l’utilise en callback afin de notifier la View de potentiels changements sur le Model.</li>
<li>Dans le code, on fait référence à la vue avec <code>this.el</code></li>
<li>Quand un utilisateur clique dans la View, c’est normalement le Controller qui s’occupe du traitement a effectuer, mais comme on l’a vu, il n’y a pas de Controller dans Backbone. Les évenements sont gérés dans la View grâce à un objet <code>event : {}</code></li>
</ul>
<h2 id="pense-b%C3%AAte-pour-le-model">Pense-bête pour le Model <a class="direct-link" href="#pense-b%C3%AAte-pour-le-model">#</a></h2>
<h3 id="m%C3%A9thodes-native-%C3%A0-backbone">Méthodes native à Backbone <a class="direct-link" href="#m%C3%A9thodes-native-%C3%A0-backbone">#</a></h3>
<ul>
<li>
<p><code>set</code> : pour changer ou initialiser un attribut du Model <code>myModel.set('toto', 'un valeur');</code></p>
</li>
<li>
<p><code>get</code> : pour obtenir la valeur d’un attribut du Model <code>myModel.get('toto');</code></p>
</li>
<li>
<p><code>validate</code> : permet de valider le model :</p>
<pre class="language-js"><code class="language-js"><span class="token function-variable function">validate</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">attributes</span><span class="token punctuation">)</span><span class="token punctuation">{</span><br>	<span class="token keyword">if</span><span class="token punctuation">(</span>attributes<span class="token punctuation">.</span>title <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">{</span><br>	    <span class="token keyword">return</span> <span class="token string">"Remember to set a title for your todo."</span><span class="token punctuation">;</span><br>	<span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre>
</li>
</ul>
<h3 id="ecoute-sur-un-model">Ecoute sur un Model <a class="direct-link" href="#ecoute-sur-un-model">#</a></h3>
<ul>
<li>
<p>Ecouter si un Model change :</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'change'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <br>	<span class="token comment">//faire quelquechose</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</li>
<li>
<p>Ecouter si l’attribut toto du model change</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'change:toto'</span><span class="token punctuation">)</span></code></pre>
</li>
</ul>
<h2 id="pense-b%C3%AAte-pour-la-view">Pense-bête pour la View <a class="direct-link" href="#pense-b%C3%AAte-pour-la-view">#</a></h2>
<p>La méthode <code>render()</code> de la View peut être liée à la méthode <code>change()</code> du Model. Ainsi dès qu’il y a un changement dans le Model, la View refléte immédiatement ces changements.</p>
<h3 id="setelement()">setElement() <a class="direct-link" href="#setelement()">#</a></h3>
<p>Colle un template HTML a une vue.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">var</span> view <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Backbone<span class="token punctuation">.</span>View</span><span class="token punctuation">;</span><br>view<span class="token punctuation">.</span><span class="token function">setElement</span><span class="token punctuation">(</span><span class="token string">'&lt;p>&lt;a>&lt;b>test&lt;/b>&lt;/a>&lt;/p>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>view<span class="token punctuation">.</span>el <span class="token comment">// &lt;p>&lt;a>&lt;b>test&lt;/b>&lt;/a>&lt;/p></span></code></pre>
<h3 id="render()">render() <a class="direct-link" href="#render()">#</a></h3>
<p>A la fin de render() il est bien de faire <code>return this</code> car :</p>
<ul>
<li>la View peut être réutiliser par des View parent</li>
<li>Créer une liste d’éléments sans repeindre chacun individuellement, l’élément est déssiné une fois par le navigateur et la liste entière est remplie en données (sens peu claire)</li>
</ul>
<h2 id="pense-b%C3%AAte-collection">Pense-bête Collection <a class="direct-link" href="#pense-b%C3%AAte-collection">#</a></h2>
<h3 id="syntaxe">Syntaxe <a class="direct-link" href="#syntaxe">#</a></h3>
<pre class="language-js"><code class="language-js"><span class="token keyword">var</span> Todo <span class="token operator">=</span> Backbone<span class="token punctuation">.</span>Model<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">var</span> TodosCollection <span class="token operator">=</span> Backbone<span class="token punctuation">.</span>Collection<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>  model<span class="token operator">:</span> Todo<br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h3 id="ajout-suppression-de-models">Ajout suppression de Models <a class="direct-link" href="#ajout-suppression-de-models">#</a></h3>
<p>Une fois la Collection créée, on peut supprimer ou ajouter des Models à la Collection avec : <code>add()</code> et <code>remove()</code>. Ces 2 méthodes acceptent un ou plusieurs model en paramètre (sous forme de tableau [])</p>
<h3 id="retrouver-un-model">Retrouver un Model <a class="direct-link" href="#retrouver-un-model">#</a></h3>
<p><code>Collection.get(id)</code> avec id l’id du Model</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">var</span> myTodo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Todo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>title<span class="token operator">:</span><span class="token string">'Read the whole book'</span><span class="token punctuation">,</span> id<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">var</span> todos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TodosCollection</span><span class="token punctuation">(</span><span class="token punctuation">[</span>myTodo<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">var</span> todo2 <span class="token operator">=</span> todos<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Afin d’intentifier le Model récupéré on peut utiliser : <code>id</code> <code>cid</code> <code>idAttribute</code></p>
<p>Chaque Model a un <code>id</code> qui est unique (type Integer ou String)<br>
<code>idAttribute</code> est l’attribut qui identifie le Model dans la database (<code>id</code> dans la base de donnée). Ca dit a Backbone quel champ de la base de donnée doit être remplir avec la propriété <code>id</code>. Exemple <code>userId</code> dans la base donnera un <code>userId</code> dans la définition du Model dans Backbone.</p>
<h3 id="ecouter-des-%C3%A9v%C3%A9nements">Ecouter des événements <a class="direct-link" href="#ecouter-des-%C3%A9v%C3%A9nements">#</a></h3>
<pre class="language-js"><code class="language-js"><span class="token keyword">var</span> TodosCollection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Backbone<span class="token punctuation">.</span>Collection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>TodosCollection<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"change:title"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">model</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"J'ai changer d'avis, je devrais "</span> <span class="token operator">+</span> model<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>TodosCollection<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">[</span><br>  <span class="token punctuation">{</span> title<span class="token operator">:</span> <span class="token string">'go to Jamaica.'</span><span class="token punctuation">,</span> completed<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> id<span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">var</span> myTodo <span class="token operator">=</span> TodosCollection<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>myTodo<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">,</span> <span class="token string">'aller nager'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Va afficher : <code>J'ai changer d'avis, je devrais aller nager</code></p>
<ul>
<li>
<p>Ecouter si il y a du changement dans une collection (ajout suppression modification) :</p>
<pre class="language-js"><code class="language-js">TodosCollection<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"add"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">model</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Ajouté "</span> <span class="token operator">+</span> model<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>TodosCollection<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"remove"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">model</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Supprimé "</span> <span class="token operator">+</span> model<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>TodosCollection<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"change:completed"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">model</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Changement de l'attribute completed "</span> <span class="token operator">+</span> model<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>TodosCollection<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><br>    <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> title<span class="token operator">:</span> <span class="token string">'go to Jamaica.'</span><span class="token punctuation">,</span> completed<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> title<span class="token operator">:</span> <span class="token string">'go to China.'</span><span class="token punctuation">,</span> completed<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span> title<span class="token operator">:</span> <span class="token string">'go to Disney World.'</span><span class="token punctuation">,</span> completed<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><br><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</li>
<li>
<p>Vider une Collection :</p>
<pre class="language-js"><code class="language-js">myCollection<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
</li>
<li>
<p>Ecouter le vidage d’une Collection :</p>
<pre class="language-js"><code class="language-js">myCollection<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"reset"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">)</span></code></pre>
</li>
<li>
<p>Attention : faire un <code>set()</code> d’une Collection peut provoquer des <code>remove()</code> ou <code>add()</code> en fonction de ce qui est setté</p>
</li>
</ul>
<h3 id="fonctionnalit%C3%A9s-h%C3%A9rit%C3%A9es-d%E2%80%99underscore">Fonctionnalités héritées d’Underscore <a class="direct-link" href="#fonctionnalit%C3%A9s-h%C3%A9rit%C3%A9es-d%E2%80%99underscore">#</a></h3>
<ul>
<li>
<p><code>forEach</code></p>
</li>
<li>
<p><code>sortBy</code></p>
</li>
<li>
<p><code>map</code></p>
</li>
<li>
<p><code>min/max</code> :</p>
<pre class="language-js"><code class="language-js">Todos<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">model</span><span class="token punctuation">)</span><span class="token punctuation">{</span><br>  <span class="token keyword">return</span> model<span class="token punctuation">.</span>id<span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>id<span class="token punctuation">;</span></code></pre>
</li>
<li>
<p><code>pluck</code></p>
</li>
<li>
<p><code>chain</code> permet de chainer l’appel de fonction sur une Collection</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">var</span> collection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Backbone<span class="token punctuation">.</span>Collection</span><span class="token punctuation">(</span><span class="token punctuation">[</span><br>  <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'Tim'</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">5</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'Ida'</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">26</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'Rob'</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">55</span> <span class="token punctuation">}</span><br><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">var</span> filteredNames <span class="token operator">=</span> collection<span class="token punctuation">.</span><span class="token function">chain</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// start chain, returns wrapper around collection's models</span><br>  <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> item<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'age'</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// returns wrapped array excluding Tim</span><br>  <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> item<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// returns wrapped array containing remaining names</span><br>  <span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// terminates the chain and returns the resulting array</span><br><br>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>filteredNames<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// logs: ['Ida', 'Rob']</span></code></pre>
</li>
</ul>
<h2 id="persistence-restful">Persistence RESTful <a class="direct-link" href="#persistence-restful">#</a></h2>
<h3 id="r%C3%A9cup%C3%A9r%C3%A9r-un-model-du-serveur">Récupérér un Model du serveur <a class="direct-link" href="#r%C3%A9cup%C3%A9r%C3%A9r-un-model-du-serveur">#</a></h3>
<p><code>Collection.fetch()</code> retrouve un ensemble de Models du server sous la form d’un tableau JSON en envoyant une requête HTTP GET vers l’URL spécifié par la propriété <code>url</code> de la Collection. Quand les données sont récupérées, la fonction <code>set()</code> va être exécuté pour mettre à jour la Collection.</p>
<h3 id="sauvegarder-un-model-sur-le-serveur">Sauvegarder un Model sur le serveur <a class="direct-link" href="#sauvegarder-un-model-sur-le-serveur">#</a></h3>
<p>On utilise la méthode <code>save()</code> du Model que l’on veut sauvegarder.</p>
<ul>
<li>Quand <code>save()</code> est appelé sur un Model qui a été récupérer du serveur avec la méthode <code>fetch()</code>, un requête HTTP PUT est envoyée.</li>
<li>Si le Model est une nouvelle instance, une requête HTTP POST est envoyé à l’URL de la Collection.</li>
</ul>
<h3 id="supprimer-un-model-du-serveur">Supprimer un Model du serveur <a class="direct-link" href="#supprimer-un-model-du-serveur">#</a></h3>
<p>Avec <code>destroy()</code> : envoie une requête HTTP DELETE</p>
<h3 id="options">Options <a class="direct-link" href="#options">#</a></h3>
<p>Il est possible de passer seulement les choses que l’on veut mettre à jour dans un Model et pas forcememnt tout le Model (requête HTTP PATCH). Par exemple :</p>
<pre class="language-js"><code class="language-js"><span class="token comment">// Sauvegarde partielle avec PATCH</span><br>model<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">{</span>id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> a<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> c<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> d<span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>model<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>model<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">{</span>b<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> d<span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>patch<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>syncArgs<span class="token punctuation">.</span>method<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token comment">// 'patch'</span></code></pre>
<h2 id="events">Events <a class="direct-link" href="#events">#</a></h2>
<h3 id="on()-off()-trigger()">on() off() trigger() <a class="direct-link" href="#on()-off()-trigger()">#</a></h3>
<p><code>Backbone.Events</code> peut donner à un objet la capacité de lié et déclencher des événements personnalisés.</p>
<p><code>on()</code> lie une fonction callback à un objet. Le callback est appelé à chaque fois que l’événement est déclenché.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">var</span> myObject <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token comment">// Mixin</span><br>_<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span>myObject<span class="token punctuation">,</span> Backbone<span class="token punctuation">.</span>Events<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">// Ajouter un événement personnalisé</span><br>myObject<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'dance'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span><span class="token punctuation">{</span><br>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Déclenchement de '</span> <span class="token operator">+</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">// Trigger the custom event</span><br>myObject<span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">'dance'</span><span class="token punctuation">,</span> <span class="token string">'our event'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p><code>off()</code> supprime toutes les fonctions de callback sur un objet</p>
<pre class="language-js"><code class="language-js"><span class="token comment">// Removes event bound to the object</span><br>myObject<span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span><span class="token string">"dance:tap"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Pour supprimer une callback en particulier :</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">var</span> ourObject <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token comment">// Mixin</span><br>_<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span>ourObject<span class="token punctuation">,</span> Backbone<span class="token punctuation">.</span>Events<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">function</span> <span class="token function">dancing</span> <span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"We are dancing. "</span> <span class="token operator">+</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><br><span class="token keyword">function</span> <span class="token function">jumping</span> <span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"We are jumping. "</span> <span class="token operator">+</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><br><br><span class="token comment">// Add two listeners to the same event</span><br>ourObject<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"move"</span><span class="token punctuation">,</span> dancing<span class="token punctuation">)</span><span class="token punctuation">;</span><br>ourObject<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"move"</span><span class="token punctuation">,</span> jumping<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">// Trigger the events. Both listeners are called.</span><br>ourObject<span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">"move"</span><span class="token punctuation">,</span> <span class="token string">"Yeah!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">// Removes specified listener</span><br>ourObject<span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span><span class="token string">"move"</span><span class="token punctuation">,</span> dancing<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">// Trigger the events again. One listener left.</span><br>ourObject<span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">"move"</span><span class="token punctuation">,</span> <span class="token string">"Yeah, jump, jump!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p><code>trigger()</code> peut passer plusieurs arguments à une fonction callback</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">var</span> ourObject <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token comment">// Mixin</span><br>_<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span>ourObject<span class="token punctuation">,</span> Backbone<span class="token punctuation">.</span>Events<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">function</span> <span class="token function">doAction</span> <span class="token punctuation">(</span><span class="token parameter">action<span class="token punctuation">,</span> duration</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"We are "</span> <span class="token operator">+</span> action <span class="token operator">+</span> <span class="token string">' for '</span> <span class="token operator">+</span> duration <span class="token punctuation">)</span><span class="token punctuation">;</span> <br><span class="token punctuation">}</span><br><br><span class="token comment">// Add event listeners</span><br>ourObject<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"dance"</span><span class="token punctuation">,</span> doAction<span class="token punctuation">)</span><span class="token punctuation">;</span><br>ourObject<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"jump"</span><span class="token punctuation">,</span> doAction<span class="token punctuation">)</span><span class="token punctuation">;</span><br>ourObject<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"skip"</span><span class="token punctuation">,</span> doAction<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">// Passing multiple arguments to single event</span><br>ourObject<span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">"dance"</span><span class="token punctuation">,</span> <span class="token string">'dancing'</span><span class="token punctuation">,</span> <span class="token string">"5 minutes"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">// Passing multiple arguments to multiple events</span><br>ourObject<span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">"dance jump skip"</span><span class="token punctuation">,</span> <span class="token string">'on fire'</span><span class="token punctuation">,</span> <span class="token string">"15 minutes"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p><code>listenTo()</code> et <code>stopListening()</code> permet à un objet {d’écouter/ arrêter d’écouter} les événements sur un autre objet.</p>
<p><em>Chaque fois qu’on fait <code>on()</code> sur un objet on doit faire aussi <code>off()</code></em>, sinon quand on supprimer un Model il va rester en mémoire. <code>View.remove()</code> fait un appel à <code>stopListening()</code> afin de s’assurer que tous les écouteurs sont déliées.</p>
<h3 id="events-et-views">Events et Views <a class="direct-link" href="#events-et-views">#</a></h3>
<p>2 types d’événements peuvent être lié à une View :</p>
<ul>
<li>événements DOM (via <code>jQuery.on()</code> this va faire référence à l’objet DOM)</li>
<li>événements déclenché via une API Event (via la propriété <code>events{}</code>,  <code>this</code> fait référence à la View)</li>
</ul>
<h2 id="routers">Routers <a class="direct-link" href="#routers">#</a></h2>
<p>Connecte des URLs à des parties de l’application. Nécessaire si tu veux que certaines parties de ton application soient : mise dans les favoris, partageable, si tu veux pouvoir faire un Back avec le bouton back du navigateur.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">var</span> TodoRouter <span class="token operator">=</span> Backbone<span class="token punctuation">.</span>Router<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>	routes<span class="token operator">:</span> <span class="token punctuation">{</span><br>		<span class="token string">"search/:query/p:page"</span> <span class="token operator">:</span> <span class="token string">"searchTodos"</span><br>		<span class="token comment">// http://example.com/#search/job/p1</span><br>	<span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">var</span> myTodoRouter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TodoRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p><code>Backbone.history.start();</code> dit à Backbone qu’il fait observer tout changement de hash dans l’URL (d’où le /# hyper vitale)</p>


<hr>
<ul><li>Next: <a href="/posts/2014-06-18-comment-bien-calculer-le-poids-dun-selecteur-css/">Comment bien calculer le poids d&#39;un selecteur CSS</a></li><li>Previous: <a href="/posts/2014-01-30-4-les-fondamentaux-de-marionette/">Les fondamentaux de Marionette</a></li>
</ul>

    </main>

    <footer></footer>

    <!-- Current page: /posts/2014-02-05-memento-backbone-dot-js/ -->
  </body>
</html>
